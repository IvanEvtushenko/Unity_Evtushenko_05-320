# Техническая документация (Unity Game of Life — PvP)

## 1. Обзор

Проект реализует клеточный автомат Конвея с редактором поля и PvP-логикой раскраски и подсчёта очков. Интерфейс построен на стандартном `Canvas`, логика — в трёх скриптах:

- `GameController` — состояние игры, UI, тик симуляции.
- `GridManager` — построение решётки `Cell[,]`, подсчёт соседей.
- `Cell` — состояние одной клетки + обработка клика мышью.

Unity: **2023.1.16f1** (2D), цель — **WebGL**.

---

## 2. Состояния и режимы

### GameState
`Editing` → `Running` → `Paused`
- Рисование разрешено в `Editing` и `Paused`.
- В `Running` клики игнорируются.

### Mode
`PvP` или `Single`
- В `PvP` цвет новорождённой клетки — по большинству соседей.
- В `Single` любые рождения окрашиваются в `P1`.
- Кнопка `Mode: PvP / Single` переключает режим; в Single кнопка `P2 Brush` неактивна.

---

## 3. Правила симуляции

Базовые правила (B3/S23): как в Конвее.

Раскраска:
- При **выживании** клетка **сохраняет** цвет.
- При **рождении** цвет определяется:
  - `PvP`: большинство среди 3 соседей → P1 или P2
  - `Single`: всегда P1

Счёт:
- На каждом шаге считается число рождений каждого цвета и прибавляется к `p1` и `p2`.
- В UI счёт **показывается на паузе**.

Окончание:
- `PvP`: если в следующем поколении `aliveP1 == 0` или `aliveP2 == 0`, игра ставится на паузу и выводится счёт.
- Вручную: кнопка `Pause`.

---

## 4. Скрипты

### 4.1. `Cell.cs`
Главные поля:
- `bool Alive`, `Owner Owner` (None / P1 / P2)
- `Init(x, y, ctrl)` — установка координат и ссылки на `GameController`.
- `SetAlive(alive, owner)` — переводит клетку в нужное состояние + цвет `SpriteRenderer`.
- `OnMouseDown()` — сообщает в контроллер: `OnCellClicked(this, right)`.

Клики:
- ЛКМ — togglе: если жива - удалить, иначе поставить кистью.

### 4.2. `GridManager.cs`
- Серийные поля: `cellPrefab`, `width`, `height`, `spacing`, `offsetX`.
- `Build(ctrl)` — создаёт матрицу `Cell[width, height]`, раскладывает префабы, центрирует камеру.
- `CountNeighbors(x, y)` → `(alive, p1, p2)` — проходит 8 соседей с проверкой границ.
- `ClearAll()` — обнуляет все клетки.

### 4.3. `GameController.cs`
- Держит ссылки на UI (кнопки/тексты/слайдер), состояние `GameState`, режим `Mode`, счёт `p1/p2`, поколение `gen`.
- `OnCellClicked(Cell c, bool right)` — логика редактирования по клику (см. выше).
- `OnPlayPause()` — переключение `Running ↔ Paused` (и включение/выключение показа счёта).
- `StepOnce()` — **ядро**:
  - Обходит сетку, строит `next[w, h]` и `own[w, h]` (цвет следующего состояния).
  - Считает рождения по цветам (`birthsP1`, `birthsP2`).
  - Считает живых P1/P2 в следующем поколении (для автоокончания в PvP).
  - Применяет новое состояние к `Cell`.
  - Инкрементирует `gen` и счёт.
  - Проверяет конец матча (исчез один цвет).

Цикл:
```csharp
IEnumerator Loop() {
    while (true) {
        StepOnce();
        yield return new WaitForSeconds(Mathf.Clamp(speedSlider.value, 0.02f, 1.5f));
    }
}
